#!/usr/bin/env bash
# Installs and configures Nginx web server to listen on port 80 and serve "Hello World!"

# Update package lists and install nginx with -y flag
apt-get update
apt-get install -y nginx

# Create a basic HTML file with "Hello World!"
echo "Hello World!" > /var/www/html/index.html

# Configure nginx to listen on port 80
# Backup the default config file
cp /etc/nginx/sites-available/default /etc/nginx/sites-available/default.bak

# Create new config file
cat > /etc/nginx/sites-available/default << 'EOF'
server {
    listen 80 default_server;
    listen [::]:80 default_server;
    root /var/www/html;
    index index.html index.htm index.nginx-debian.html;
    server_name _;
    location / {
        try_files $uri $uri/ =404;
    }
}
EOF

# Test nginx configuration
nginx -t

# Start nginx service without using systemctl
if pgrep nginx > /dev/null; then
    service nginx restart
else
    service nginx start
fi
